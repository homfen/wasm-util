/*! For license information please see ffmpeg.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var i in r)("object"==typeof exports?exports:t)[i]=r[i]}}(self,(function(){return(()=>{var t={389:()=>{let t=null,e=null,r=!1;const i=Error("FFmpeg.js is not ready, make sure you have completed load()."),a=Error("FFmpeg.js can only run one command at a time"),n=(t,e)=>{if(null===Module)throw i;return Module.FS[t](...e)},s=t=>new Promise((e=>{if(t instanceof File||t instanceof Blob){const r=new FileReader;r.onload=function(t){const r=t.target.result;e(new Uint8Array(r))},r.readAsArrayBuffer(t)}else t instanceof ArrayBuffer&&e(new Uint8Array(t))})),o=t=>{const e=[];let r=0,i=0;for(;(r=t.indexOf(" ",i))>=0;){let a=t.substring(i,r),n=a.indexOf("'"),s=a.indexOf('"');if(0===n||0===s){const n=a[0],s=t.indexOf(n,i+1);if(s<0)throw new Error(`Bad command escape sequence ${n} near ${r}`);a=t.substring(i+1,s),i=s+2,e.push(a)}else if(n>0||s>0){-1===n&&(n=1/0),-1===s&&(s=1/0);const o=n<s?"'":'"',u=Math.min(n,s),g=t.indexOf(o,i+u+1);if(g<0)throw new Error(`Bad command escape sequence ${o} near ${r}`);a=t.substring(i,g+1),i=g+2,e.push(a)}else""!==a?(e.push(a),i=r+1):i=r+1}return i!==t.length&&e.push(t.substring(i)),e},u=()=>new Promise((t=>{Object.keys(Module.asm).length?t():setTimeout((()=>{t(u())}),1e3)})),g=["./ffmpeg","-nostdin","-hide_banner"];self.onmessage=f=>{const{files:c,type:p,name:l,args:d,url:h,debug:m=!1}=f.data;let b=null;(async()=>{try{switch(p){case"init":Module={urlPrefix:h},self.importScripts(h+"ffmpeg-core.js"),await u(),t=Module.cwrap("main","number",["number","number"]),Module.setLogger((t=>{const{type:i,message:a}=t;(({message:t,type:i})=>{"ffmpeg-stdout"===i&&"FFMPEG_END"===t&&null!==e&&(e(),e=null,r=!1)})(t),m&&console.log(i,a)})),self.postMessage({type:p});break;case"write":await(async(t,e)=>n("writeFile",[t,await s(e)]))(c.name,c.data),self.postMessage({type:p,name:c.name});break;case"read":b=n("readFile",[l]),self.postMessage({type:p,name:l,list:[b]});break;case"remove":n("unlink",[l]),self.postMessage({type:p,name:l});break;case"run":await(n=>{if(null===t)throw i;if(r)throw a;return r=!0,new Promise((r=>{const i=[...g,...o(n)].filter((t=>0!==t.length));e=r;const a=(t=>{const e=Module._malloc(t.length*Uint32Array.BYTES_PER_ELEMENT);return t.forEach(((t,r)=>{const i=(t=>{const e=Module._malloc((t.length+1)*Uint8Array.BYTES_PER_ELEMENT);for(let r=0;r<t.length;r+=1)Module.setValue(e+r,t.charCodeAt(r),"i8");return Module.setValue(e+t.length,0,"i8"),e})(t);Module.setValue(e+4*r,i,"i32")})),e})(i);t(i.length,a)}))})(d),self.postMessage({type:p,name:l,args:d})}}catch(t){self.postMessage({type:"error",name:t.toString()})}})()}},970:(t,e,r)=>{"use strict";function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}r.r(e),r.d(e,{default:()=>v});var n=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var r=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(r,1),r>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var r=e.length,i=0;i<r;++i)e[i].call(this,arguments[1]);else for(var a=Array.prototype.slice.call(arguments,1),n=e.length,s=0;s<n;++s)e[s].apply(this,a)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}();function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}var o=r(908),u=r.n(o);function g(t){for(var e,r=(e=t,u().atob?u().atob(e):Buffer.from(e,"base64").toString("binary")),i=new Uint8Array(r.length),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return i}var f=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return a(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(n),c=String.fromCharCode(9),p=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),r={};return e[1]&&(r.length=parseInt(e[1],10)),e[2]&&(r.offset=parseInt(e[2],10)),r},l=function(t){for(var e,r=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},a=r.length;a--;)""!==r[a]&&((e=/([^=]*)=(.*)/.exec(r[a]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),i[e[0]]=e[1]);return i},d=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}a(e,t);var r=e.prototype;return r.push=function(t){var e,r,i=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce((function(e,r){var i=r(t);return i===t?e:e.concat([i])}),[t]).forEach((function(t){for(var a=0;a<i.customParsers.length;a++)if(i.customParsers[a].call(i,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return r={type:"tag",tagType:"inf"},e[1]&&(r.duration=parseFloat(e[1])),e[2]&&(r.title=e[2]),void i.trigger("data",r);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"targetduration"},e[1]&&(r.duration=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"version"},e[1]&&(r.version=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"media-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return r={type:"tag",tagType:"playlist-type"},e[1]&&(r.playlistType=e[1]),void i.trigger("data",r);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return r=s(p(e[1]),{type:"tag",tagType:"byterange"}),void i.trigger("data",r);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return r={type:"tag",tagType:"allow-cache"},e[1]&&(r.allowed=!/NO/.test(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"map"},e[1]){var n=l(e[1]);n.URI&&(r.uri=n.URI),n.BYTERANGE&&(r.byterange=p(n.BYTERANGE))}i.trigger("data",r)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"stream-inf"},e[1]){if(r.attributes=l(e[1]),r.attributes.RESOLUTION){var o=r.attributes.RESOLUTION.split("x"),u={};o[0]&&(u.width=parseInt(o[0],10)),o[1]&&(u.height=parseInt(o[1],10)),r.attributes.RESOLUTION=u}r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))}i.trigger("data",r)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return r={type:"tag",tagType:"media"},e[1]&&(r.attributes=l(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-ENDLIST/.exec(t))i.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return r={type:"tag",tagType:"program-date-time"},e[1]&&(r.dateTimeString=e[1],r.dateTimeObject=new Date(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return r={type:"tag",tagType:"key"},e[1]&&(r.attributes=l(e[1]),r.attributes.IV&&("0x"===r.attributes.IV.substring(0,2).toLowerCase()&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),void i.trigger("data",r);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return r={type:"tag",tagType:"start"},e[1]&&(r.attributes=l(e[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),void i.trigger("data",r);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out-cont"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-in"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"skip"}).attributes=l(e[1]),r.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10)),r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split(c)),void i.trigger("data",r);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"part"}).attributes=l(e[1]),["DURATION"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))})),r.attributes.hasOwnProperty("BYTERANGE")&&(r.attributes.byterange=p(r.attributes.BYTERANGE)),void i.trigger("data",r);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"server-control"}).attributes=l(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))})),void i.trigger("data",r);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"part-inf"}).attributes=l(e[1]),["PART-TARGET"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),void i.trigger("data",r);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"preload-hint"}).attributes=l(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(r.attributes.hasOwnProperty(t)){r.attributes[t]=parseInt(r.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";r.attributes.byterange=r.attributes.byterange||{},r.attributes.byterange[e]=r.attributes[t],delete r.attributes[t]}})),void i.trigger("data",r);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"rendition-report"}).attributes=l(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseInt(r.attributes[t],10))})),void i.trigger("data",r);i.trigger("data",{type:"tag",data:t.slice(4)})}}}else i.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))},r.addParser=function(t){var e=this,r=t.expression,i=t.customType,a=t.dataParser,n=t.segment;"function"!=typeof a&&(a=function(t){return t}),this.customParsers.push((function(t){if(r.exec(t))return e.trigger("data",{type:"custom",data:a(t),customType:i,segment:n}),!0}))},r.addTagMapper=function(t){var e=t.expression,r=t.map;this.tagMappers.push((function(t){return e.test(t)?r(t):t}))},e}(n),h=function(t){var e={};return Object.keys(t).forEach((function(r){var i;e[(i=r,i.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()})))]=t[r]})),e},m=function(t){var e=t.serverControl,r=t.targetDuration,i=t.partTargetDuration;if(e){var a="#EXT-X-SERVER-CONTROL",n="holdBack",s="partHoldBack",o=r&&3*r,u=i&&2*i;r&&!e.hasOwnProperty(n)&&(e[n]=o,this.trigger("info",{message:a+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&e[n]<o&&(this.trigger("warn",{message:a+" clamping HOLD-BACK ("+e[n]+") to targetDuration * 3 ("+o+")"}),e[n]=o),i&&!e.hasOwnProperty(s)&&(e[s]=3*i,this.trigger("info",{message:a+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[s]+")."})),i&&e[s]<u&&(this.trigger("warn",{message:a+" clamping PART-HOLD-BACK ("+e[s]+") to partTargetDuration * 2 ("+u+")."}),e[s]=u)}},b=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new f,e.parseStream=new d,e.lineStream.pipe(e.parseStream);var r,i,a=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e),n=[],o={},u=!1,c=function(){},p={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},l=0;e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var b=0,y=0;return e.on("end",(function(){o.uri||!o.parts&&!o.preloadHints||(!o.map&&r&&(o.map=r),!o.key&&i&&(o.key=i),o.timeline||"number"!=typeof l||(o.timeline=l),e.manifest.preloadSegment=o)})),e.parseStream.on("data",(function(t){var e,f;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(o.byterange=e,e.length=t.length,"offset"in t||(t.offset=b)),"offset"in t&&(o.byterange=e,e.offset=t.offset),b=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(o.duration=t.duration),0===t.duration&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:g(t.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(i.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,l=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){r={},t.uri&&(r.uri=t.uri),t.byterange&&(r.byterange=t.byterange)},"stream-inf":function(){this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||p,t.attributes?(o.attributes||(o.attributes={}),s(o.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||p,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var r=this.manifest.mediaGroups[t.attributes.TYPE];r[t.attributes["GROUP-ID"]]=r[t.attributes["GROUP-ID"]]||{},e=r[t.attributes["GROUP-ID"]],(f={default:/yes/i.test(t.attributes.DEFAULT)}).default?f.autoselect=!0:f.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(f.language=t.attributes.LANGUAGE),t.attributes.URI&&(f.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(f.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(f.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(f.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=f}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){l+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),o.dateTimeString=t.dateTimeString,o.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,m.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){o.cueOut=t.data},"cue-out-cont":function(){o.cueOutCont=t.data},"cue-in":function(){o.cueIn=t.data},skip:function(){this.manifest.skip=h(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;u=!0;var r=this.manifest.segments.length,i=h(t.attributes);o.parts=o.parts||[],o.parts.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=y),y=i.byterange.offset+i.byterange.length);var a=o.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+a+" for segment #"+r,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((function(t,r){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+r+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=h(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),m.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,r=h(t.attributes),i=r.type&&"PART"===r.type;o.preloadHints=o.preloadHints||[],o.preloadHints.push(r),r.byterange&&(r.byterange.hasOwnProperty("offset")||(r.byterange.offset=i?y:0,i&&(y=r.byterange.offset+r.byterange.length)));var a=o.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+a+" for segment #"+e,t.attributes,["TYPE","URI"]),r.type)for(var n=0;n<o.preloadHints.length-1;n++){var s=o.preloadHints[n];s.type&&s.type===r.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+a+" for segment #"+e+" has the same TYPE "+r.type+" as preload hint #"+n})}},"rendition-report":function(){var e=h(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var r=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];u&&i.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+r,t.attributes,i)},"part-inf":function(){this.manifest.partInf=h(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),m.call(this,this.manifest)}}[t.tagType]||c).call(a)},uri:function(){o.uri=t.uri,n.push(o),this.manifest.targetDuration&&!("duration"in o)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),i&&(o.key=i),o.timeline=l,r&&(o.map=r),y=0,o={}},comment:function(){},custom:function(){t.segment?(o.custom=o.custom||{},o.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(a)})),e}a(e,t);var r=e.prototype;return r.warnOnMissingAttributes_=function(t,e,r){var i=[];r.forEach((function(t){e.hasOwnProperty(t)||i.push(t)})),i.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+i.join(", ")})},r.push=function(t){this.lineStream.push(t)},r.end=function(){this.lineStream.push("\n"),this.trigger("end")},r.addParser=function(t){this.parseStream.addParser(t)},r.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(n),y=r(122),E=r.n(y);function T(t){const e=t.indexOf("#");e>-1&&(t=t.slice(0,e));const r=t.indexOf("?");r>-1&&(t=t.slice(0,r));const i=t.match(/\/([^\/]+)$/);if(i&&i.length)return i[1]}class v{constructor(t){const{libPath:e,onChange:r=console.log,debug:i=!1,fromList:a=!0}=t;this.libPath=e,this.onChange=r.bind(this),this.debug=i,this.fromList=a,this.initWorker()}initWorker(){this.worker=E()(389),this.worker.onmessage=t=>{const{type:e,name:r,list:i,args:a}=t.data;switch(e){case"init":setTimeout((()=>{this.onChange({type:e})}),100);break;case"write":case"remove":case"error":this.fromList&&"write"===e?(this.currentFile=r,this.getBySecond(r,this.currentTime)):this.onChange({type:e,name:r});break;case"run":this.fromList?this.readFile(r):this.onChange({type:e,name:r,args:a});break;case"read":this.fromList&&(this.removeFile(this.currentFile),this.removeFile(r));const t=i.map((t=>"data:image/jpeg;base64,"+function(t){for(var e="",r=t.byteLength,i=0;i<r;i++)e+=String.fromCharCode(t[i]);return window.btoa(e)}(t)));this.onChange({type:e,name:r,imgs:t})}},this.worker.postMessage({type:"init",url:this.libPath,debug:this.debug})}loadList(t){this.listUrl=t,this.urlPrefix=t.slice(0,t.lastIndexOf("/")+1),fetch(t).then((t=>t.text())).then((t=>{const e=new b;e.push(t),e.end(),this.manifest=e.manifest,this.manifest.segments.forEach(((t,e,r)=>{const i=r[e-1];t.start=i?i.end:0,t.end=t.start+t.duration})),console.log("manifest",this.manifest),this.onChange({type:"loadList"})}))}readFile(t){this.worker.postMessage({type:"read",name:t})}writeFile(t,e){e||(e=T(t)),fetch(t).then((t=>t.arrayBuffer())).then((t=>{this.worker.postMessage({type:"write",files:{name:e,data:t}})}))}removeFile(t){t&&this.worker.postMessage({type:"remove",name:t})}getByFrame(t,e){const r=["-threads 1",`-i ${t}`,"-loglevel repeat+level+verbose",`-vf select='eq(n, ${e})'`,"-vframes 1","0.jpg"].join(" ");this.run(r,"0.jpg")}getBySecond(t,e){const r=["-threads 1",`-i ${t}`,"-loglevel repeat+level+verbose","-err_detect aggressive","-fflags discardcorrupt",`-ss ${function(t){t=Math.floor(t);const e=Math.floor(t/3600),r=Math.floor((t-3600*e)/60);return[e,r,t-3600*e-60*r].map((t=>t<10?`0${t}`:t)).join(":")}(e)}`,"-vframes 1","0.jpg"].join(" ");this.run(r,"0.jpg")}getBySecondFromList(t){const e=this.getSegmentBySecond(t);if(!e)return void this.onChange({type:"error",name:"time out of range"});this.currentTime=t-e.start;const r=e.uri.indexOf("http")>-1?e.uri:this.urlPrefix+e.uri,i=T(e.uri);this.writeFile(r,i)}getSegmentBySecond(t){return this.manifest.segments.find((({start:e,end:r})=>e<=t&&t<r))}run(t,e){this.worker.postMessage({type:"run",name:e,args:t})}destroy(){this.worker.terminate()}}},908:(t,e,r)=>{var i;i="undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},t.exports=i},122:(t,e,r)=>{function i(t){var e={};function r(i){if(e[i])return e[i].exports;var a=e[i]={i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r.oe=function(t){throw console.error(t),t};var i=r(r.s=ENTRY_MODULE);return i.default||i}var a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function n(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(t,e,i){var s={};s[i]=[];var o=e.toString(),u=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return s;for(var g,f=u[1],c=new RegExp("(\\\\n|\\W)"+n(f)+a,"g");g=c.exec(o);)"dll-reference"!==g[3]&&s[i].push(g[3]);for(c=new RegExp("\\("+n(f)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+a,"g");g=c.exec(o);)t[g[2]]||(s[i].push(g[1]),t[g[2]]=r(g[1]).m),s[g[2]]=s[g[2]]||[],s[g[2]].push(g[4]);for(var p,l=Object.keys(s),d=0;d<l.length;d++)for(var h=0;h<s[l[d]].length;h++)p=s[l[d]][h],isNaN(1*p)||(s[l[d]][h]=1*s[l[d]][h]);return s}function o(t){return Object.keys(t).reduce((function(e,r){return e||t[r].length>0}),!1)}t.exports=function(t,e){e=e||{};var a={main:r.m},n=e.all?{main:Object.keys(a.main)}:function(t,e){for(var r={main:[e]},i={main:[]},a={main:{}};o(r);)for(var n=Object.keys(r),u=0;u<n.length;u++){var g=n[u],f=r[g].pop();if(a[g]=a[g]||{},!a[g][f]&&t[g][f]){a[g][f]=!0,i[g]=i[g]||[],i[g].push(f);for(var c=s(t,t[g][f],g),p=Object.keys(c),l=0;l<p.length;l++)r[p[l]]=r[p[l]]||[],r[p[l]]=r[p[l]].concat(c[p[l]])}}return i}(a,t),u="";Object.keys(n).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;n[t][e];)e++;n[t].push(e),a[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+t+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map((function(e){return JSON.stringify(e)+": "+a[t][e].toString()})).join(",")+"});\n"})),u=u+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n.main.map((function(t){return JSON.stringify(t)+": "+a.main[t].toString()})).join(",")+"}))(self);";var g=new window.Blob([u],{type:"text/javascript"});if(e.bare)return g;var f=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(g),c=new window.Worker(f);return c.objectURL=f,c}}},e={};function r(i){var a=e[i];if(void 0!==a)return a.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,r),n.exports}return r.m=t,r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(970)})()}));